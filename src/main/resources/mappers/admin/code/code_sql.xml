<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whomade.planfAi.admin.code.mapper.CodeMapper">

    <select id="selectGroupCodeList" resultType="com.whomade.planfAi.admin.code.dto.CodeGroupDto">
        SELECT 
            A.GROUP_ID,
            A.GROUP_NM,
            A.GROUP_NM_ENG,
            A.RM,
            A.REGISTER_NO,
            A.REGIST_DT,
            B.USER_NM AS registerNm,
            DATE_FORMAT(A.REGIST_DT, '%Y.%m.%d') AS registYmd
        FROM op_code_group A
        LEFT JOIN op_user B ON A.REGISTER_NO = B.USER_NO
        <where>
            <if test="schGroupNm != null and schGroupNm != ''">
                AND A.GROUP_NM LIKE CONCAT('%', #{schGroupNm}, '%')
            </if>
        </where>
        ORDER BY A.GROUP_ID DESC
        LIMIT #{offset}, #{limit}
    </select>

    <select id="selectGroupCodeCount" resultType="int">
        SELECT COUNT(*)
        FROM op_code_group
        <where>
            <if test="schGroupNm != null and schGroupNm != ''">
                AND GROUP_NM LIKE CONCAT('%', #{schGroupNm}, '%')
            </if>
        </where>
    </select>

    <select id="selectGroupCodeDetail" resultType="com.whomade.planfAi.admin.code.dto.CodeGroupDto">
        SELECT * FROM op_code_group WHERE GROUP_ID = #{groupId}
    </select>

    <insert id="insertGroupCode" parameterType="com.whomade.planfAi.admin.code.dto.CodeGroupDto">
        INSERT INTO op_code_group (
            GROUP_ID, GROUP_NM, GROUP_NM_ENG, RM, REGISTER_NO, REGIST_DT
        ) VALUES (
            #{groupId}, #{groupNm}, #{groupNmEng}, #{rm}, #{registerNo}, NOW()
        )
    </insert>

    <update id="updateGroupCode" parameterType="com.whomade.planfAi.admin.code.dto.CodeGroupDto">
        UPDATE op_code_group SET
            GROUP_NM = #{groupNm},
            GROUP_NM_ENG = #{groupNmEng},
            RM = #{rm},
            UPDUSR_NO = #{updusrNo},
            UPDT_DT = NOW()
        WHERE GROUP_ID = #{groupId}
    </update>

    <delete id="deleteGroupCode">
        DELETE FROM op_code_group WHERE GROUP_ID = #{groupId}
    </delete>

    <select id="selectCodeList" resultType="com.whomade.planfAi.admin.code.dto.CodeDto">
        SELECT * FROM op_code 
        WHERE GROUP_ID = #{groupId}
        ORDER BY SORT_ORDR ASC
    </select>

    <insert id="insertCode" parameterType="com.whomade.planfAi.admin.code.dto.CodeDto">
        INSERT INTO op_code (
            GROUP_ID, CODE, CODE_NM, CODE_NM_ENG, ATTRB_1, ATTRB_2, ATTRB_3, SORT_ORDR, USE_YN, REGISTER_NO, REGIST_DT
        ) VALUES (
            #{groupId}, #{code}, #{codeNm}, #{codeNmEng}, #{attrb1}, #{attrb2}, #{attrb3}, #{sortOrdr}, #{useYn}, #{registerNo}, NOW()
        )
    </insert>

    <update id="updateCode" parameterType="com.whomade.planfAi.admin.code.dto.CodeDto">
        UPDATE op_code SET
            CODE_NM = #{codeNm},
            CODE_NM_ENG = #{codeNmEng},
            ATTRB_1 = #{attrb1},
            ATTRB_2 = #{attrb2},
            ATTRB_3 = #{attrb3},
            SORT_ORDR = #{sortOrdr},
            USE_YN = #{useYn},
            UPDUSR_NO = #{updusrNo},
            UPDT_DT = NOW()
        WHERE GROUP_ID = #{groupId} AND CODE = #{code}
    </update>

    <delete id="deleteCode">
        DELETE FROM op_code WHERE GROUP_ID = #{groupId} AND CODE = #{code}
    </delete>

    <delete id="deleteCodesByGroupId">
        DELETE FROM op_code WHERE GROUP_ID = #{groupId}
    </delete>

    <!-- Small Classification (Sclas) -->
    <select id="selectSclasCodeList" resultType="com.whomade.planfAi.admin.code.dto.SclasCodeDto">
        SELECT * FROM op_sclas_code
        WHERE GROUP_ID = #{groupId} AND CODE = #{code}
        ORDER BY SORT_ORDR ASC
    </select>

    <insert id="insertSclasCode" parameterType="com.whomade.planfAi.admin.code.dto.SclasCodeDto">
        INSERT INTO op_sclas_code (
            GROUP_ID, CODE, SCLAS_CODE, SCLAS_NM, ATTRB_1, ATTRB_2, ATTRB_3, ATTRB_4, SORT_ORDR, USE_YN, REGISTER_NO, REGIST_DT
        ) VALUES (
            #{groupId}, #{code}, #{sclasCode}, #{sclasNm}, #{attrb1}, #{attrb2}, #{attrb3}, #{attrb4}, #{sortOrdr}, #{useYn}, #{registerNo}, NOW()
        )
    </insert>

    <update id="updateSclasCode" parameterType="com.whomade.planfAi.admin.code.dto.SclasCodeDto">
        UPDATE op_sclas_code SET
            SCLAS_NM = #{sclasNm},
            ATTRB_1 = #{attrb1},
            ATTRB_2 = #{attrb2},
            ATTRB_3 = #{attrb3},
            ATTRB_4 = #{attrb4},
            SORT_ORDR = #{sortOrdr},
            USE_YN = #{useYn},
            UPDUSR_NO = #{updusrNo},
            UPDT_DT = NOW()
        WHERE GROUP_ID = #{groupId} AND CODE = #{code} AND SCLAS_CODE = #{sclasCode}
    </update>

    <delete id="deleteSclasCode">
        DELETE FROM op_sclas_code 
        WHERE GROUP_ID = #{groupId} AND CODE = #{code} AND SCLAS_CODE = #{sclasCode}
    </delete>

    <!-- Sub Classification (Sdclas) -->
    <select id="selectSdclasCodeList" resultType="com.whomade.planfAi.admin.code.dto.SdclasCodeDto">
        SELECT * FROM op_sdclas_code
        WHERE GROUP_ID = #{groupId} AND CODE = #{code} AND SCLAS_CODE = #{sclasCode}
        ORDER BY SORT_ORDR ASC
    </select>

    <insert id="insertSdclasCode" parameterType="com.whomade.planfAi.admin.code.dto.SdclasCodeDto">
        INSERT INTO op_sdclas_code (
            GROUP_ID, CODE, SCLAS_CODE, SDCLAS_CODE, SDCLAS_NM, ATTRB_1, ATTRB_2, ATTRB_3, SORT_ORDR, USE_YN, REGISTER_NO, REGIST_DT
        ) VALUES (
            #{groupId}, #{code}, #{sclasCode}, #{sdclasCode}, #{sdclasNm}, #{attrb1}, #{attrb2}, #{attrb3}, #{sortOrdr}, #{useYn}, #{registerNo}, NOW()
        )
    </insert>

    <update id="updateSdclasCode" parameterType="com.whomade.planfAi.admin.code.dto.SdclasCodeDto">
        UPDATE op_sdclas_code SET
            SDCLAS_NM = #{sdclasNm},
            ATTRB_1 = #{attrb1},
            ATTRB_2 = #{attrb2},
            ATTRB_3 = #{attrb3},
            SORT_ORDR = #{sortOrdr},
            USE_YN = #{useYn},
            UPDUSR_NO = #{updusrNo},
            UPDT_DT = NOW()
        WHERE GROUP_ID = #{groupId} AND CODE = #{code} AND SCLAS_CODE = #{sclasCode} AND SDCLAS_CODE = #{sdclasCode}
    </update>

    <delete id="deleteSdclasCode">
        DELETE FROM op_sdclas_code 
        WHERE GROUP_ID = #{groupId} AND CODE = #{code} AND SCLAS_CODE = #{sclasCode} AND SDCLAS_CODE = #{sdclasCode}
    </delete>

</mapper>
