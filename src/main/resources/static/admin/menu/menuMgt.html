<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메뉴 관리 - PlanfAi 관리자</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/admin/js/admin_common.js"></script>
    <link href="/admin/css/admin_style.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Top Header -->
        <header class="admin-header">
            <div class="logo-area">planF</div>
            <nav class="nav-area">
                <div class="nav-item active">시스템</div>
                <div class="nav-item">기본정보</div>
                <div class="nav-item">포인트 관리</div>
                <div class="nav-item">게시판</div>
            </nav>
            <div class="user-info">
                <i class="bi bi-person-fill me-1"></i> admin
                <a href="/admin/logout.do" class="ms-3"><i class="bi bi-unlock-fill me-1"></i> Logout</a>
            </div>
        </header>

        <div class="main-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <a class="nav-link" href="/admin/main.do">
                    대시보드
                </a>
                <a class="nav-link active" href="/admin/menu/selectListMenuMgt.do">
                    메뉴 관리
                </a>
                <a class="nav-link" href="/admin/author/selectPageListAuthorMgt.do">
                    권한 관리
                </a>
                <a class="nav-link" href="#">
                    사용자 관리
                </a>
                <a class="nav-link" href="#">
                    코드 관리
                </a>
            </aside>

            <!-- Main Content -->
            <main class="content">
                <div class="page-title-box">
                    <h2 class="page-title">메뉴 관리</h2>
                    <div class="breadcrumb-area">
                        <i class="bi bi-house-door"></i> > 시스템 > <span class="text-dark fw-bold">메뉴 관리</span>
                    </div>
                </div>

                <!-- Search Area -->
                <div class="search-box-wrapper">
                    <input type="text" class="search-input" placeholder="메뉴명 또는 URL">
                    <button class="btn-search-icon"><i class="bi bi-search"></i></button>
                </div>

                <!-- Action Buttons Area -->
                <div class="actions-area">
                    <!-- Delete button is already in row, but the image shows a bulk delete button often -->
                    <!-- <button class="btn-action btn-delete"><i class="bi bi-trash"></i> 삭제</button> -->
                </div>

                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;"><input type="checkbox"></th>
                                <th style="width: 15%;">메뉴 ID</th>
                                <th>메뉴명</th>
                                <th>URL</th>
                                <th style="width: 10%;">정렬</th>
                                <th style="width: 10%;">사용여부</th>
                                <th style="width: 15%;">액션</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="menu in menuList" :key="menu.menuId" :class="'menu-level-' + menu.menuLevel">
                                <td><input type="checkbox"></td>
                                <td>{{ menu.menuId }}</td>
                                <td class="text-start">
                                    <span v-if="menu.menuLevel > 1" class="text-muted me-1">└</span>
                                    {{ menu.menuNm }}
                                </td>
                                <td>{{ menu.url }}</td>
                                <td>{{ menu.sortOrdr }}</td>
                                <td>
                                    <span class="badge" :class="menu.useYn === 'Y' ? 'bg-success' : 'bg-secondary'">
                                        {{ menu.useYn === 'Y' ? '사용' : '미사용' }}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-secondary me-1" @click="openModal(menu.menuId)">
                                        <i class="bi bi-plus-sm"></i> 하위
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary me-1" @click="editMenu(menu)">수정</button>
                                    <button class="btn btn-sm btn-outline-danger" @click="deleteMenu(menu.menuId)">삭제</button>
                                </td>
                            </tr>
                            <tr v-if="menuList.length === 0">
                                <td colspan="7" class="text-center py-5 text-muted">등록된 메뉴가 없습니다.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

        <!-- Menu Form Modal (Placeholder) -->
        <div class="modal fade" id="menuModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ modalTitle }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">부모 메뉴 ID</label>
                            <input type="text" v-model="form.parentMenuId" class="form-control" readonly>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label">메뉴 ID (4자리)</label>
                                <input type="text" v-model="form.subMenuId" class="form-control" placeholder="예: 1000" maxlength="4">
                            </div>
                            <div class="col-6 mb-3">
                                <label class="form-label">메뉴 유형</label>
                                <select v-model="form.menuTyCode" class="form-select">
                                    <option value="10">카테고리</option>
                                    <option value="20">메뉴</option>
                                    <option value="30">기능</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">메뉴명</label>
                            <input type="text" v-model="form.menuNm" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">URL</label>
                            <input type="text" v-model="form.url" class="form-control">
                        </div>
                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label">정렬 순서</label>
                                <input type="number" v-model="form.sortOrdr" class="form-control">
                            </div>
                            <div class="col-6 mb-3">
                                <label class="form-label">사용 여부</label>
                                <select v-model="form.useYn" class="form-select">
                                    <option value="Y">사용</option>
                                    <option value="N">미사용</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                        <button type="button" class="btn btn-primary" @click="saveMenu">저장</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const { createApp, ref, onMounted } = Vue;
        createApp({
            setup() {
                const menuList = ref([]);
                const form = ref({ parentMenuId: '', subMenuId: '', menuTyCode: '20', menuNm: '', url: '', sortOrdr: 1, useYn: 'Y' });
                const modalTitle = ref('메뉴 등록');
                let modalObj = null;

                const fetchMenus = () => {
                    axios.get('/api/admin/menu')
                        .then(res => menuList.value = res.data)
                        .catch(err => alert('메뉴 조회 실패'));
                };

                const openModal = (parentId = '') => {
                    form.value = { parentMenuId: parentId, subMenuId: '', menuTyCode: '20', menuNm: '', url: '', sortOrdr: 1, useYn: 'Y' };
                    modalTitle.value = parentId ? '하위 메뉴 추가' : '최상위 메뉴 추가';
                    modalObj.show();
                };

                const editMenu = (menu) => {
                    const fullId = menu.menuId;
                    modalTitle.value = '메뉴 수정';
                    form.value = {
                        parentMenuId: fullId.length > 4 ? fullId.substring(0, fullId.length - 4) : '',
                        subMenuId: fullId.substring(fullId.length - 4),
                        menuTyCode: menu.menuTyCode,
                        menuNm: menu.menuNm,
                        url: menu.url,
                        sortOrdr: menu.sortOrdr,
                        useYn: menu.useYn
                    };
                    modalObj.show();
                };

                const deleteMenu = (menuId) => {
                    if (confirm('해당 메뉴와 모든 하위 메뉴가 삭제됩니다. 계속하시겠습니까?')) {
                        axios.delete(`/api/admin/menu/${menuId}`)
                            .then(() => {
                                alert('삭제되었습니다.');
                                fetchMenus();
                            })
                            .catch(err => AdminUtil.handleApiError(err, '삭제 실패'));
                    }
                };

                const saveMenu = () => {
                    axios.post('/api/admin/menu', form.value)
                        .then(() => {
                            modalObj.hide();
                            fetchMenus();
                        })
                        .catch(err => alert(err.response.data));
                };

                onMounted(() => {
                    modalObj = new bootstrap.Modal(document.getElementById('menuModal'));
                    fetchMenus();
                });

                return { menuList, form, modalTitle, openModal, editMenu, deleteMenu, saveMenu };
            }
        }).mount('#app');
    </script>
</body>
</html>
